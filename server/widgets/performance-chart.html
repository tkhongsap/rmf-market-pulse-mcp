<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; padding: 16px; }
    .chart-container {
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      background: white;
    }
    .chart-header {
      border-bottom: 2px solid #f3f4f6;
      padding-bottom: 16px;
      margin-bottom: 20px;
    }
    .chart-title {
      font-size: 18px;
      font-weight: 700;
      color: #111827;
      margin-bottom: 4px;
    }
    .chart-subtitle {
      font-size: 14px;
      color: #6b7280;
    }
    .performance-chart {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 20px;
    }
    .chart-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .period-label {
      width: 60px;
      font-size: 13px;
      font-weight: 600;
      color: #374151;
      text-align: right;
    }
    .bar-container {
      flex: 1;
      height: 32px;
      background: #f3f4f6;
      border-radius: 6px;
      position: relative;
      overflow: hidden;
    }
    .bar {
      height: 100%;
      border-radius: 6px;
      transition: width 0.3s ease;
      position: relative;
    }
    .bar.positive {
      background: linear-gradient(90deg, #059669 0%, #10b981 100%);
    }
    .bar.negative {
      background: linear-gradient(90deg, #dc2626 0%, #ef4444 100%);
    }
    .bar-value {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 13px;
      font-weight: 600;
      color: white;
    }
    .value-label {
      width: 80px;
      font-size: 14px;
      font-weight: 600;
      text-align: right;
    }
    .value-label.positive { color: #059669; }
    .value-label.negative { color: #dc2626; }
    .benchmark-section {
      background: #f9fafb;
      border-radius: 8px;
      padding: 16px;
      margin-top: 16px;
    }
    .benchmark-title {
      font-size: 14px;
      font-weight: 600;
      color: #374151;
      margin-bottom: 12px;
    }
    .benchmark-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 12px;
    }
    .benchmark-item {
      text-align: center;
      padding: 8px;
      background: white;
      border-radius: 6px;
    }
    .benchmark-label {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 4px;
    }
    .benchmark-value {
      font-size: 14px;
      font-weight: 600;
      color: #374151;
    }
    .legend {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #e5e7eb;
      font-size: 13px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 4px;
    }
    .legend-color.positive { background: #10b981; }
    .legend-color.negative { background: #ef4444; }
  </style>
</head>
<body>
  <div class="chart-container">
    <div class="chart-header">
      <div class="chart-title" id="chartTitle"></div>
      <div class="chart-subtitle" id="chartSubtitle"></div>
    </div>

    <div class="performance-chart" id="performanceChart"></div>

    <div class="benchmark-section" id="benchmarkSection" style="display: none;">
      <div class="benchmark-title" id="benchmarkTitle"></div>
      <div class="benchmark-grid" id="benchmarkGrid"></div>
    </div>

    <div class="legend">
      <div class="legend-item">
        <div class="legend-color positive"></div>
        <span>Positive Return</span>
      </div>
      <div class="legend-item">
        <div class="legend-color negative"></div>
        <span>Negative Return</span>
      </div>
    </div>
  </div>

  <script>
    const data = window.openai.toolOutput._meta;

    // Set title
    document.getElementById('chartTitle').textContent = data.title || 'Performance Analysis';
    document.getElementById('chartSubtitle').textContent = data.subtitle || 'Returns by period';

    // Render performance chart
    const performanceData = data.performance || [];
    const chartContainer = document.getElementById('performanceChart');

    // Find max absolute value for scaling
    const maxValue = Math.max(...performanceData.map(p => Math.abs(parseFloat(p.value) || 0)));

    performanceData.forEach(item => {
      const value = parseFloat(item.value);
      const isPositive = value >= 0;
      const percentage = maxValue > 0 ? (Math.abs(value) / maxValue) * 100 : 0;
      const barWidth = Math.max(percentage, 5); // Minimum 5% width for visibility

      chartContainer.innerHTML += `
        <div class="chart-row">
          <div class="period-label">${item.period}</div>
          <div class="bar-container">
            <div class="bar ${isPositive ? 'positive' : 'negative'}" style="width: ${barWidth}%">
              ${barWidth > 15 ? `<span class="bar-value">${value.toFixed(2)}%</span>` : ''}
            </div>
          </div>
          <div class="value-label ${isPositive ? 'positive' : 'negative'}">
            ${value >= 0 ? '+' : ''}${value.toFixed(2)}%
          </div>
        </div>
      `;
    });

    // Render benchmark comparison if available
    if (data.benchmark && data.benchmark.name) {
      const benchmarkSection = document.getElementById('benchmarkSection');
      benchmarkSection.style.display = 'block';

      document.getElementById('benchmarkTitle').textContent =
        `Benchmark: ${data.benchmark.name}`;

      const benchmarkGrid = document.getElementById('benchmarkGrid');
      const benchmarkMetrics = [
        { label: 'YTD', value: data.benchmark.ytd },
        { label: '3M', value: data.benchmark['3m'] },
        { label: '6M', value: data.benchmark['6m'] },
        { label: '1Y', value: data.benchmark['1y'] },
        { label: '3Y', value: data.benchmark['3y'] },
        { label: '5Y', value: data.benchmark['5y'] }
      ];

      benchmarkMetrics.forEach(({ label, value }) => {
        if (value !== undefined && value !== null) {
          benchmarkGrid.innerHTML += `
            <div class="benchmark-item">
              <div class="benchmark-label">${label}</div>
              <div class="benchmark-value">${parseFloat(value).toFixed(2)}%</div>
            </div>
          `;
        }
      });
    }
  </script>
</body>
</html>
